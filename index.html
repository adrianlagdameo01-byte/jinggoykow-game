<script>

// ================= SPACE BACKGROUND =================
const canvas = document.getElementById('spaceBG');
const ctx = canvas.getContext('2d');
canvas.width = window.innerWidth;
canvas.height = window.innerHeight;

const stars=[];
for(let i=0;i<150;i++){
    stars.push({
        x:Math.random()*canvas.width,
        y:Math.random()*canvas.height,
        r:Math.random()*1.2,
        vx:(Math.random()-0.5)/2,
        vy:(Math.random()-0.5)/2
    });
}

const planets=[
  {x:300,y:120,r:50,color:"rgba(255,100,150,0.6)",vx:0.03,vy:0.02},
  {x:800,y:450,r:70,color:"rgba(100,200,255,0.5)",vx:-0.02,vy:0.01},
  {x:1200,y:220,r:35,color:"rgba(255,255,100,0.5)",vx:0.015,vy:0.02}
];

let shootingStars=[];
for(let i=0;i<3;i++){
    shootingStars.push({
        x:Math.random()*canvas.width,
        y:Math.random()*canvas.height,
        length:100,
        speed:Math.random()*6+2,
        active:false
    });
}

function drawSpace(){
    const grad=ctx.createRadialGradient(
        canvas.width/2,canvas.height/2,0,
        canvas.width/2,canvas.height/2,
        canvas.width/1.5
    );
    grad.addColorStop(0,"rgba(255,100,150,0.08)");
    grad.addColorStop(0.5,"rgba(100,150,255,0.05)");
    grad.addColorStop(1,"rgba(0,0,0,0.9)");
    ctx.fillStyle=grad;
    ctx.fillRect(0,0,canvas.width,canvas.height);

    for(let s of stars){
        ctx.beginPath();
        ctx.arc(s.x,s.y,s.r,0,Math.PI*2);
        ctx.fillStyle="white";
        ctx.fill();
        s.x+=s.vx;
        s.y+=s.vy;
        if(s.x<0)s.x=canvas.width;
        if(s.x>canvas.width)s.x=0;
        if(s.y<0)s.y=canvas.height;
        if(s.y>canvas.height)s.y=0;
    }

    for(let p of planets){
        ctx.beginPath();
        ctx.arc(p.x,p.y,p.r,0,Math.PI*2);
        ctx.fillStyle=p.color;
        ctx.fill();
        p.x+=p.vx;
        p.y+=p.vy;
        if(p.x-p.r>canvas.width)p.x=-p.r;
        if(p.x+p.r<0)p.x=canvas.width+p.r;
        if(p.y-p.r>canvas.height)p.y=-p.r;
        if(p.y+p.r<0)p.y=canvas.height+p.r;
    }

    shootingStars.forEach(st=>{
        if(!st.active){
            if(Math.random()<0.008) st.active=true;
        }
        if(st.active){
            ctx.strokeStyle="white";
            ctx.lineWidth=2;
            ctx.shadowColor="white";
            ctx.shadowBlur=10;
            ctx.beginPath();
            ctx.moveTo(st.x,st.y);
            ctx.lineTo(st.x+st.length,st.y+st.length);
            ctx.stroke();
            st.x+=st.speed;
            st.y+=st.speed;
            if(st.x>canvas.width||st.y>canvas.height){
                st.active=false;
            }
        }
    });

    requestAnimationFrame(drawSpace);
}
drawSpace();


// ================= GAME VARIABLES =================
let score=0;
let heartsMissed=0;
let gameStopped=false;
let gameWon=false;

const music=document.getElementById("bgMusic");

document.addEventListener("click",()=>{
    music.volume=0.6;
    music.play().catch(()=>{});
},{once:true});

document.addEventListener("touchstart",()=>{
    music.volume=0.6;
    music.play().catch(()=>{});
},{once:true});


// ================= CINEMATIC EFFECT =================
function cinematicExplosion(){

    // zoom
    document.body.style.transition="transform 0.4s ease";
    document.body.style.transform="scale(1.05)";
    setTimeout(()=>{
        document.body.style.transform="scale(1)";
    },400);

    // pink flash
    const flash=document.createElement("div");
    flash.style.position="fixed";
    flash.style.top="0";
    flash.style.left="0";
    flash.style.width="100%";
    flash.style.height="100%";
    flash.style.background="rgba(255,105,180,0.35)";
    flash.style.pointerEvents="none";
    flash.style.zIndex="5";
    document.body.appendChild(flash);
    setTimeout(()=>flash.remove(),400);

    // vibration
    if(navigator.vibrate){
        navigator.vibrate(200);
    }

    // sparkle burst
    for(let i=0;i<35;i++){
        const boom=document.createElement("div");
        boom.className="explosion";
        boom.innerHTML=Math.random()>0.5?"üíñ":"‚ú®";
        boom.style.left=Math.random()*100+"vw";
        boom.style.top=Math.random()*100+"vh";
        document.body.appendChild(boom);
        setTimeout(()=>boom.remove(),1000);
    }
}


// ================= HEARTS =================
function createHeart(){
    if(gameStopped||gameWon) return;

    const heart=document.createElement("div");
    heart.classList.add("heart");
    heart.innerHTML="‚ù§Ô∏è";

    const dir=Math.floor(Math.random()*4);
    let duration=3 + Math.random()*1.5;

    if(dir===0){
        heart.style.left=30+Math.random()*40+"vw";
        heart.style.animation="floatUp "+duration+"s linear forwards";
    }
    if(dir===1){
        heart.style.left=30+Math.random()*40+"vw";
        heart.style.animation="floatDown "+duration+"s linear forwards";
    }
    if(dir===2){
        heart.style.top=20+Math.random()*60+"vh";
        heart.style.animation="floatLeft "+duration+"s linear forwards";
    }
    if(dir===3){
        heart.style.top=20+Math.random()*60+"vh";
        heart.style.animation="floatRight "+duration+"s linear forwards";
    }

    heart.style.textShadow="0 0 10px #ff69b4,0 0 20px #ff1493,0 0 30px #ff69b4,0 0 40px #ff1493";

    heart.onclick=function(){

        score++;
        document.getElementById("score").innerText="Hearts: "+score;

        if(score===14){
            cinematicExplosion();
        }

        if(score>=14 && !gameWon){

            const msg=document.getElementById("catchMessage");
            const sc=document.getElementById("score");

            msg.style.opacity=0;
            sc.style.opacity=0;

            setTimeout(()=>{
                msg.style.display="none";
                sc.style.display="none";

                const winBox=document.getElementById("winBox");
                winBox.style.display="block";
                setTimeout(()=>{winBox.style.opacity=1;},50);
                setTimeout(()=>{
                    winBox.style.opacity=0;
                    setTimeout(()=>{winBox.style.display="none";},500);
                },3000);

            },1500);

            endGame();
        }

        heart.remove();
    };

    document.body.appendChild(heart);

    setTimeout(()=>{
        if(heart.parentNode){
            heart.remove();
            heartsMissed++;
            if(heartsMissed>=5 && !gameWon){
                showGameOver();
            }
        }
    },8000);
}


// ================= GAME OVER =================
function showGameOver(){
    score=0;
    heartsMissed=0;
    const sc=document.getElementById("score");
    sc.innerText="Hearts: 0";
    sc.style.opacity=1;
    gameStopped=true;
    document.getElementById("gameOver").style.display="block";
}

function continueGame(){
    gameStopped=false;
    document.getElementById("gameOver").style.display="none";
}


// ================= FINAL =================
function endGame(){
    gameWon=true;
    gameStopped=true;
    document.getElementById("gameOver").style.display="none";
    document.getElementById("finalScreen").style.display="block";

    const lines=document.querySelectorAll(".line");
    let delay=4000;

    lines.forEach((line,i)=>{
        setTimeout(()=>{
            line.style.opacity=1;
            line.classList.add("glow");
        },delay*(i+1));
    });

    setTimeout(()=>{
        document.getElementById("yesBtn").style.display="inline-block";
        document.getElementById("noBtn").style.display="inline-block";
    },delay*(lines.length+1));
}


// ================= YES BUTTON =================
function yesClicked(){
    for(let i=0;i<20;i++){
        const boom=document.createElement("div");
        boom.className="explosion";
        boom.innerHTML="üíñ";
        boom.style.left=Math.random()*100+"vw";
        boom.style.top=Math.random()*100+"vh";
        document.body.appendChild(boom);
        setTimeout(()=>boom.remove(),1200);
    }

    const finalLine=document.getElementById("finalLine");
    finalLine.style.display="block";
    setTimeout(()=>{finalLine.style.opacity=1;},100);

    alert("I'm forever yours Jinggoykow ‚ù§Ô∏èüíñüòçü•∞ Happy Heart's Day! üíòüíû");
    startFireworks();
}


// ================= NO BUTTON =================
const noBtn=document.getElementById("noBtn");

function moveNoButton(){
    noBtn.style.left=Math.random()*80+"vw";
    noBtn.style.top=Math.random()*80+"vh";
}

noBtn.addEventListener("mouseover",moveNoButton);
noBtn.addEventListener("click",moveNoButton);
noBtn.addEventListener("touchstart",moveNoButton);

setInterval(createHeart,1150);


// ================= FIREWORKS =================
const fwCanvas=document.getElementById("fireworksCanvas");
const fwCtx=fwCanvas.getContext("2d");
fwCanvas.width=window.innerWidth;
fwCanvas.height=window.innerHeight;

let fireworks=[];

function startFireworks(){
    fireworks=[];
    for(let i=0;i<20;i++){
        fireworks.push({
            x:Math.random()*fwCanvas.width,
            y:fwCanvas.height,
            targetY:Math.random()*fwCanvas.height/2,
            sparks:[],
            exploded:false
        });
    }
    requestAnimationFrame(drawFireworks);
}

function drawFireworks(){
    fwCtx.clearRect(0,0,fwCanvas.width,fwCanvas.height);

    fireworks.forEach(fw=>{
        if(!fw.exploded){
            fw.y-=5;
            if(fw.y<=fw.targetY){
                fw.exploded=true;
                for(let j=0;j<20;j++){
                    fw.sparks.push({
                        x:fw.x,
                        y:fw.y,
                        vx:(Math.random()-0.5)*5,
                        vy:(Math.random()-0.5)*5,
                        alpha:1
                    });
                }
            }
        } else {
            fw.sparks.forEach(s=>{
                s.x+=s.vx;
                s.y+=s.vy;
                s.alpha-=0.02;
                if(s.alpha>0){
                    fwCtx.fillStyle="rgba(255,105,180,"+s.alpha+")";
                    fwCtx.beginPath();
                    fwCtx.arc(s.x,s.y,3,0,Math.PI*2);
                    fwCtx.fill();
                }
            });
        }
    });

    requestAnimationFrame(drawFireworks);
}

</script>

